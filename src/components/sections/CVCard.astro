---
import { DownloadIcon } from 'lucide-react'
import Card from '@/components/Card.astro'
import { Button } from '@/components/ui/button'
---

<Card colSpan="lg:col-span-1" rowSpan="md:row-span-1">
  <div class="flex h-full flex-col items-center justify-center gap-4 text-center">
    <h2 id="cv-title" data-i18n="cv.title" class="text-2xl font-bold">
      Currículum
    </h2>
    <a
      id="cv-download-link"
      class="w-full md:w-auto"
      href="/sergio-morales-2024-es.pdf"
      target="_blank"
      rel="noopener noreferrer"
    >
      <Button class="w-full">
        <span id="cv-download-label" data-i18n="cv.button" class="mr-2">
          Descargar currículum
        </span>
        <DownloadIcon class="h-4 w-4" />
      </Button>
    </a>
  </div>
</Card>

<script>
  const EN_PDF = '/sergio-morales-2024-en.pdf'
  const ES_PDF = '/sergio-morales-2024-es.pdf'

  const getLanguage = () =>
    window.portfolioLanguage?.getLanguage?.() ||
    localStorage.getItem('language') ||
    'es'

  const setDownloadLink = language => {
    const link = document.getElementById('cv-download-link')
    if (!(link instanceof HTMLAnchorElement)) return

    link.href = language === 'en' ? EN_PDF : ES_PDF
  }

  const handleLanguageChange = event => {
    const nextLanguage = event?.detail?.language || getLanguage()
    setDownloadLink(nextLanguage)
  }

  if (typeof window !== 'undefined') {
    setDownloadLink(getLanguage())
    window.addEventListener('languageChange', handleLanguageChange)
    document.addEventListener('astro:after-swap', () => {
      setDownloadLink(getLanguage())
    })
  }
</script>
