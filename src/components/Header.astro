---
import { buttonVariants } from '@/components/ui/button'
import { ModeToggle } from '@/components/ui/ThemeToggle'
import { LangToggle } from '@/components/ui/LangToggle'
---

<script is:inline>
  document.addEventListener('astro:after-swap', function () {
    const theme = localStorage.getItem('theme')
    const systemPrefersDark = window.matchMedia(
      '(prefers-color-scheme: dark)',
    ).matches

    if (theme === 'dark' || (theme === null && systemPrefersDark)) {
      document.documentElement.classList.toggle('dark', true)
    }
  })

  const getThemePreference = () => {
    const savedTheme = localStorage.getItem('theme')
    if (savedTheme) return savedTheme

    // Check system preference if no saved preference
    return window.matchMedia('(prefers-color-scheme: dark)').matches
      ? 'dark'
      : 'light'
  }

  const isDark = getThemePreference() === 'dark'
  document.documentElement.classList[isDark ? 'add' : 'remove']('dark')
</script>

<header
  class="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60"
>
  <div class="mx-auto flex h-16 w-full max-w-6xl items-center justify-between gap-6 px-4 sm:px-6">
    <a href="/" class="flex items-center space-x-2 whitespace-nowrap">
      <span class="inline-block font-bold">SergioGMR</span>
    </a>
    <nav class="flex flex-1 items-center justify-end gap-2 sm:gap-4">
      <LangToggle client:load />
      <a
        href="https://github.com/sergiogmr"
        target="_blank"
        rel="noreferrer"
        class={buttonVariants({ variant: 'ghost' })}
      >
        GitHub
      </a>
      <ModeToggle client:load />
    </nav>
  </div>
</header>
